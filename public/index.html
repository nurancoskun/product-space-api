<!DOCTYPE html>
<html lang="tr">
<head><meta charset="UTF-8" /><title>Datas API Tester</title></head>
<body style="font-family:sans-serif; padding:20px;">
  <h2>Passthrough (source)</h2>
  <input id="raw" placeholder="source/CrSt/export-value/6digit/2024/data" style="width:600px"/>
  <input id="rawcity" placeholder="cityname=Ankara" />
  <button onclick="goRaw()">Getir</button>

  <h2>v1 API</h2>
  <input id="section" placeholder="CrSt | EcSt | StSp | PtSp | Latent"/>
  <input id="topic" placeholder="export-value | employment | ..."/>
  <input id="digit" placeholder="6digit | 4digit | main | sub"/>
  <input id="year" placeholder="2024 | all"/>
  <input id="viz" placeholder="CrSt | pie | timeline | heatmap | ..."/>
  <input id="v1city" placeholder="cityname=Ankara"/>
  <button onclick="goV1()">Getir</button>

  <pre id="out" style="background:#f4f4f4; padding:10px; white-space:pre-wrap;"></pre>

<script>
async function goRaw(){
  const p = document.getElementById('raw').value.trim();
  const city = document.getElementById('rawcity').value.trim();
  const q = city ? ('?cityname=' + encodeURIComponent(city)) : '';
  const res = await fetch('/datas/' + p + q);
  const t = await res.text();
  try{ out.textContent = JSON.stringify(JSON.parse(t), null, 2); }catch{ out.textContent = t; }
}

async function goV1(){
  const s = section.value.trim();
  const t = topic.value.trim();
  const d = digit.value.trim();
  const y = year.value.trim();
  const v = viz.value.trim();
  const city = document.getElementById('v1city').value.trim();
  const path = `/datas/v1/${s}/${t}/${d}/${y}/${v}` + (city?`?cityname=${encodeURIComponent(city)}`:"");
  const res = await fetch(path);
  const txt = await res.text();
  try{ out.textContent = JSON.stringify(JSON.parse(txt), null, 2); }catch{ out.textContent = txt; }
}
</script>
</body>
</html>
